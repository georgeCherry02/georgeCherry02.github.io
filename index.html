<!DOCTYPE html>
<style>
  
  /*Change the box sizing style*/
  * {
    box-sizing: border-box;
  }
  
  /*Removing default body margin*/
  body {
    margin: 0px;
  }
  
  /*making header smarter*/
  h3 {
    padding: 0px;
    border: 0px;
    margin: 0px;
  }
  #version {
    border: 0px;
  }
  
  /*Defining columns*/
  .col-1 {width: 1.92%;}
  .col-2 {width: 16.66%;}
  .col-3 {width: 25%;}
  .col-4 {width: 33.33%;}
  .col-5 {width: 41.66%;}
  .col-6 {width: 50%;}
  .col-7 {width: 58.33%;}
  .col-8 {width: 66.66%;}
  .col-9 {width: 75%;} 
  .col-10 {width: 83.33%;} 
  .col-11 {width: 91.66%;} 
  .col-12 {width: 100%;}
  .col-13 {width: 8.33%;}
  
  /*Making columns behave*/
  [class*="col-"] {
    float: left;
    border: 0.01px solid black;
  }
  
  /*Making rows behave*/
  .row::after {
    content: "";
    clear: both;
    display: table;
  }
  
  /*Natural element style*/
  .grassElement {
    text-align: center;
    background-color: #0a911e;
    padding: 0.96%;
  }
  .waterElement {
    background-color: #43acf2;
    padding: 0.96%;
  }
  .stoneElement {
    background-color: #ccc;
    padding: 0.96%;
  }
  .treeElement {
    background-color: #02702a;
    padding: 0.96%;
  }
  .edgeElement {
    background-color: #eee;
    padding: 0.96%
  }
  
  /*Making grass glow*/
  .grassElement:hover {
    background-color: #39ce43;
  }
  
  /*Building style*/
  button.tent {
    background-color: #afad69;
  }
  button.forester {
    background-color: #6d5402;
  }
  button.miner {
    background-color: #5d605d;
  }
  button.keepCore {
    background-color: #888;
  }
  button.keepWall {
    background-color: #bbb;
    border: 0.01px solid black;
    box-sizing: border-box;
  }
  button.wall {
    background-color: #bbb;
    border: 0.01px solid black;
    box-sizing: border-box;
  }
  button.path {
    background-color: #8b993e;
  }
  
  /*buildMenu style*/
  
  /*General structure*/
  .buildMenu {
    position: fixed;
    bottom: 0px;
    width: 100%;
    height: 100px;
    background-color: #ddd;
    z-index: 5;
    border: 2px solid #aaa;
  }
  .buildIcon {
    margin: 0px;
    padding-top: 10px;
  }
  /*Function buttons*/
  button.exit {
    background-color: red;
    color: white;
    border: 1px solid black;
    border-radius: 5px;
  }
  button#buildMenuButton {
    background-color: blue;
    color: white;
    border: 1px solid black;
    border-radius: 5px;
  }
  button#deleteMenuButton {
    background-color: red;
    color: white;
    border: 1px solid black;
    border-radius: 5px;
  }
  /*Building icons*/
  label.buildLabel {
    border: none;
    text-align: center;
  }
  /*Statistic presentation*/
  p.statIcon {
    border: 1px solid black;
    border-radius: 5px;
    text-align: center;
  }
  p#pop {
    background-color: blue;
  }
  p#money {
    background-color: yellow;
  }
  p#wood {
    background-color: #7c591b;
  }
  p#stone {
    background-color: #ccc;
  }
  p#idlePop {
    background-color: red;
  }
  
  /*Accomodating the build menu*/
  .buildMenuHole {
    position: relative;
    bottom: 0px;
    height: 100px;
  }
  
</style>
<html>
  <head>
  
    <title>Testing Javascript</title>  
    
  </head>  
  <body onLoad='generate()'>
    
    <!--Version Declaration-->
    <div class='row header'>
      <h3 class="col-6" id='version'>Version 0.003.011</h3>
      <button class='col-2' onClick='regenerate()'>Regenerate</button>
      <button class='col-2' onClick='hideBuildMenu()'>Hide menu</button>
      <button class='col-2' onClick='start()'>Start</button>
    </div>
    
    <!--Testing Buttons-->

    <!--Actual Grid-->
    <div id='grid'>
      
    </div>
    
    <!--Build menu-->
    <div class='row buildMenu' id='buildMenu' style='display:none;'>
      <div class='row buildButtons'>
        <button class='col-2' onClick='buildTile()' id='buildMenuButton'>Build</button>
        <div class='col-13'></div>
        <button class='col-2' onClick='deleteTile()' id='deleteMenuButton'>Delete</button>
        <div class='col-6'></div>        
        <button class='col-13 exit' onClick='hideBuildMenu()'>X</button>
      <div class='row buildIcons'>
        <input type='radio' name='buildT' id='keep' class='col-1 buildIcon'>
        <label for='keep' class='col-13 buildLabel'>Keep</label>
        <input type='radio' name='buildT' id='wall' class='col-1 buildIcon'>
        <label for='wall' class='col-13 buildLabel'>Wall</label>
        <input type='radio' name='buildT' id='path' class='col-1 buildIcon'>
        <label for='path' class='col-13 buildLabel'>Path</label>
        <input type='radio' name='buildT' id='tent' class='col-1 buildIcon'>
        <label for='tent' class='col-13 buildLabel'>Tent</label>
        <input type='radio' name='buildT' id='forester' class='col-1 buildIcon'>
        <label for='forester' class='col-13 buildLabel'>Forester</label>
        <input type='radio' name='buildT' id='miner' class='col-1 buildIcon'>        
        <label for='miner' class='col-13 buildLabel'>Mine</label>
      </div>
      <div class='row stats'>
        <p class='col-2 statIcon' id='pop'></p>
        <p class='col-2 statIcon' id='money'></p>
        <p class='col-2 statIcon' id='wood'></p>
        <p class='col-2 statIcon' id='stone'></p>
        <p class='col-3 statIcon' id='idlePop'></p>
      </div>
    </div>
    <div class='buildMenuHole' id='buildMenuHole' style='display:none;'>
      
    </div>
    
    <script>
      
      //Natural generation functions
      
      function generateLand() {
        for (j=0;j<52;j++) {
          var initContGT = document.getElementById('grid').innerHTML;
          document.getElementById('grid').innerHTML = initContGT + "<div class='row' id='row" + j.toString() + "'></div>"
          for (i=0;i<52;i++) {
            if (j==0||j==51) {
              var initContGE = document.getElementById('row' + j.toString()).innerHTML;
              document.getElementById('row' + j.toString()).innerHTML = initContGE + "<div class='col-1 edgeElement' id='col" + i.toString() + '-' + j.toString() + "'></div>";
            } else {
              if (i==0||i==51) {
                var initContGRE = document.getElementById('row' + j.toString()).innerHTML;
                document.getElementById('row' + j.toString()).innerHTML = initContGRE + "<div class='col-1 edgeElement' id='col" + i.toString() + '-' + j.toString() + "'></div>";
              } else {
                var initContG = document.getElementById('row' + j.toString()).innerHTML;
                document.getElementById('row' + j.toString()).innerHTML = initContG + "<button onClick='tileBuild(this.id)' class='col-1 grassElement' id='col" + i.toString() + '-' + j.toString() + "'></button>";
              }
            }
          }
        }
      }
      function generateWater() {
        for (a=0;a<10;a++) {
          var waterLocX = Math.floor(Math.random()*50)+1;
          var waterLocY = Math.floor(Math.random()*50)+1;
          if ((waterLocX>3 && waterLocX<47) && (waterLocY>3 && waterLocY<47)) {
            for (i=waterLocX-2;i<waterLocX+3;i++) {
              if (i==waterLocX-2 || i==waterLocX+2) {
                for (j=waterLocY-1;j<waterLocY+2;j++) {
                  document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 waterElement';
                }
              } else {
                for (j=waterLocY-2;j<waterLocY+3;j++) {
                  document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 waterElement';
                }
              }
            }
          }
        }
      }
      function generateStone() {
        for (a=0;a<40;a++) {
          var stoneLocX = Math.floor(Math.random()*50)+1;
          var stoneLocY = Math.floor(Math.random()*50)+1;
          var bigStoneP = Math.floor(Math.random()*10)+1;
          if (bigStoneP<3) {
            for (i=stoneLocX;i<stoneLocX+2;i++) {
              for (j=stoneLocY;j<stoneLocY+2;j++) {
                if ((stoneLocX<51&&stoneLocY<51)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                  document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 stoneElement';
                }
              }
            }
          } else {
            if (!(document.getElementById('col' + stoneLocX.toString() + '-' + stoneLocY.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement'))) {
              document.getElementById('col' + stoneLocX.toString() + '-' + stoneLocY.toString()).className = 'col-1 stoneElement';
            }
          }
        }
      }
      function generateTree() {
        for (a=0;a<10;a++) {
          var forestLocX = Math.floor(Math.random()*50)+1;
          var forestLocY = Math.floor(Math.random()*50)+1;
          if ((forestLocX>3 && forestLocY<47)&&(forestLocY>3 && forestLocY<47)) {
            for (i=forestLocX-4;i<forestLocX+5;i++) {
              for (j=forestLocY-4;j<forestLocY+5;j++) {
                var treeP = Math.floor(Math.random()*100)+1;
                if (i==forestLocX-4||i==forestLocX+4) {
                  if ((treeP<6)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                    document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                  }
                } else if (i==forestLocX-3||i==forestLocX+3) {
                  if (j==forestLocY-4||j==forestLocY+4) {
                    if ((treeP<6)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                      document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                    }
                  } else {
                    if ((treeP<51)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                      document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                    }
                  }
                } else if (i==forestLocX-2||i==forestLocX+2) {
                  if (j==forestLocY-4||j==forestLocY+4) {
                    if ((treeP<6)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                      document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                    }
                  } else if (j==forestLocY-3||j==forestLocY+3) {
                    if ((treeP<51)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                      document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                    }
                  } else {
                    if ((treeP<76)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                      document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                    }
                  }
                } else {
                  if (j==forestLocY-4||j==forestLocY+4) {
                    if ((treeP<6)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                      document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                    }
                  } else if (j==forestLocY-3||j==forestLocY+3) {
                    if ((treeP<51)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                      document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                    }
                  } else if (j==forestLocY-2||j==forestLocY+2) {
                    if ((treeP<76)&&(!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement')))) {
                      document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                    }                   
                  } else {
                    if (!(document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('waterElement')||document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains('edgeElement'))) {
                      document.getElementById('col' + i.toString() + '-' + j.toString()).className = 'col-1 treeElement';
                    }
                  }
                }
              }                
            }                 
          }
        }
      }
      function generate() {
        generateLand();
        generateWater();
        generateStone();
        generateTree();
      }
      function eraseC() {
        document.getElementById('grid').innerHTML = '';
      }
      function regenerate() {
        eraseC();
        generate();
      }
      
      //Building functions      
      
      function tileBuild(pos) {
        showBuildMenu();
        document.getElementById('buildMenuButton').setAttribute('onClick','buildTile("'+pos+'")');
        document.getElementById('deleteMenuButton').setAttribute('onClick','deleteTile("'+pos+'")');
      }
      function hideBuildMenu() {
        document.getElementById('buildMenu').setAttribute('style','display:none;');
        document.getElementById('buildMenuHole').setAttribute('style','display:none;');
      }
      function showBuildMenu() {
        document.getElementById('buildMenu').setAttribute('style','');
        document.getElementById('buildMenuHole').setAttribute('style','');    
      }
      function buildTile(buildPos) {
        if ((document.getElementById('tent').checked)&&(document.getElementById(buildPos).classList.contains('grassElement'))) {
          document.getElementById(buildPos).className+=' tent';
        } else if ((document.getElementById('forester').checked)&&(document.getElementById(buildPos).classList.contains('grassElement'))&&(checkSurround(buildPos,'treeElement',1)>2)&&(checkSurround(buildPos,'forester',3)<1)&&(idlePop>0)) {
          document.getElementById(buildPos).className+=' forester';
        } else if ((document.getElementById('miner').checked)&&(document.getElementById(buildPos).classList.contains('grassElement'))&&(checkSurround(buildPos,'stoneElement',1)>0)&&(idlePop>0)&&(wood>14)) {
          document.getElementById(buildPos).className+=' miner';
          wood-=15;
        } else if ((document.getElementById('keep').checked)&&(checkSurround(buildPos,'grassElement',1)==9)&&(keepPresent==0)&&(stone>99)&&(wood>49)&&(population>9)) {
          var posX = Number(buildPos.slice(3,5));
          var posY = Number(buildPos.slice(6,8));
          for (i=posX-1;i<posX+2;i++) {
            for (j=posY-1;j<posY+2;j++) {
              if (i==posX&&j==posY) {
                document.getElementById(buildPos).className+=' keepCore';
              } else {
                document.getElementById('col' + i.toString() + '-' + j.toString()).className+=' keepWall';
              }
            }
          }
          keepPresent++;
          stone-=100;
          wood-=50;
        } else if ((document.getElementById('wall').checked)&&(document.getElementById(buildPos).classList.contains('grassElement'))) {
          document.getElementById(buildPos).className+=' wall';
        } else if ((document.getElementById('path').checked)&&(document.getElementById(buildPos).classList.contains('grassElement'))) {
          document.getElementById(buildPos).className+=' path';
        }
      }
      function deleteTile(deletePos) {
        var tile = document.getElementById(deletePos);
        tile.className = 'col-1 grassElement';
      }
      function checkSurround(checkPos,checkFor,r) {
        var posX = Number(checkPos.slice(3,5));
        var posY = Number(checkPos.slice(6,8));
        var presence = 0;
        for (i=posX-r;i<posX+r+1;i++) {
          for (j=posY-r;j<posY+r+1;j++) {
            if (document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains(checkFor)) {
              presence++;
            }
          }
        }
        return presence;
      }
      
      //Time dependent functions
      
      function start() {
        var tick = setInterval(timeDependent, 3000);
      }
      function timeDependent() {
        displayEcon();
      }
      
      //Defining economy
      
      //Global economy values
      
      var keepPresent = 0;
      var population = 0;
      var workPop = 0;
      var money = 0;
      var wood = 0;
      var stone = 0;
      var idlePop = 0;
      
      //Economy functions
      
      function displayEcon() {
        economyCalc();
        document.getElementById('pop').innerHTML = 'Population: ' + population.toString();
        document.getElementById('money').innerHTML = 'Money: ' + money.toString();
        document.getElementById('wood').innerHTML = 'Wood: ' + wood.toString();
        document.getElementById('stone').innerHTML = 'Stone: ' + stone.toString();
        document.getElementById('idlePop').innerHTML = 'Idle population: ' + idlePop.toString();
      }
      
      function economyCalc() {
        workPop = 0;
        for (a=0;a<3;a++) {
          switch (a) {
            case (0):
              var count = countTileValue('tent');
              population = count;
              if (keepPresent==1) {
                money+= count;
              }
              break;
            case (1):
              var count = countTileValue('forester');
              wood+= count;
              workPop+= count;
              break;
            case (2):
              var count = countTileValue('miner');
              stone+= count;
              workPop+= count;
          }
        }
        idlePop = population-workPop;
      }
      function countTileValue(tileName) {
        var count = 0;
        for (i=1;i<51;i++) {
          for (j=1;j<51;j++) {
            if (document.getElementById('col' + i.toString() + '-' + j.toString()).classList.contains(tileName)) {
              count++;
            }
          }
        }
        return count;
      }
        
    </script>
  </body>
</html>
